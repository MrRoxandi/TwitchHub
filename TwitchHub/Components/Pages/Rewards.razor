<!-- Pages/Rewards.razor -->
@page "/rewards"
@inject ISnackbar Snackbar

<div class="mb-6">
    <MudText Typo="Typo.h5" Style="font-weight: 700;">Награды канала</MudText>
    <MudText Typo="Typo.body2" Class="mud-text-secondary">Синхронизация с Lua backend.</MudText>
</div>

<MudGrid>
    @foreach (var reward in _rewards)
    {
        <MudItem xs="12" sm="6" lg="4">
            <MudPaper Class="pa-4 d-flex flex-column gap-2" Outlined="true" Style="border-color: #27272a;">
                <div class="d-flex justify-space-between align-start mb-2">
                    <MudPaper Elevation="0" Class="d-flex align-center justify-center rounded-lg" Style="@($"width: 48px; height: 48px; background: {reward.Color}33;")">
                        <MudIcon Icon="@GetIcon(reward.Type)" Style="@($"color: {reward.Color}")" />
                    </MudPaper>
                    <MudSwitch T="bool" @bind-Value="@reward.IsEnabled" Color="Color.Success" />
                </div>

                <MudText Typo="Typo.h6" Style="font-weight: 700;">@reward.Title</MudText>

                <div class="d-flex align-center gap-1 mb-2">
                    <MudIcon Icon="@Icons.Material.Filled.FlashOn" Size="Size.Small" Color="Color.Primary" />
                    <MudText Typo="Typo.body2" Color="Color.Primary" Style="font-weight: 700;">@reward.Cost</MudText>
                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Points</MudText>
                </div>

                <MudDivider Class="my-2" />

                <div class="d-flex justify-space-between align-center">
                    <MudText Typo="Typo.caption" Class="mud-text-secondary" Style="text-transform: uppercase;">ТИП: @reward.Type</MudText>
                    <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined" Color="@(reward.IsEnabled? Color.Success: Color.Default)">
                        @(reward.IsEnabled ? "Активна" : "Скрыта")
                    </MudChip>
                </div>
            </MudPaper>
        </MudItem>
    }
</MudGrid>

@code {
    class RewardItem { public string Title { get; set; } public int Cost { get; set; } public string Color { get; set; } public string Type { get; set; } public bool IsEnabled { get; set; } }

    private List<RewardItem> _rewards = new()
    {
        new() { Title = "Озвучить", Cost = 100, Color = "#e91e63", Type = "tts", IsEnabled = true },
        new() { Title = "Звук Airhorn", Cost = 500, Color = "#9c27b0", Type = "sound", IsEnabled = true },
        new() { Title = "Конфетти", Cost = 1000, Color = "#06b6d4", Type = "script", IsEnabled = false },
        new() { Title = "Выпить воды", Cost = 250, Color = "#2196f3", Type = "none", IsEnabled = true },
    };

    private string GetIcon(string type) => type switch { "tts" => Icons.Material.Filled.RecordVoiceOver, "sound" => Icons.Material.Filled.VolumeUp, "script" => Icons.Material.Filled.Code, _ => Icons.Material.Filled.FlashOn };

    private void ToggleReward(RewardItem item, bool value)
    {
        item.IsEnabled = value;
        Snackbar.Add($"Статус награды обновлен", Severity.Info);
    }
}